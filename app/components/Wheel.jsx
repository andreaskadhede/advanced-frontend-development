import { useEffect, useState } from "react";
import Image from "next/image";
import Link from "next/link";

export default function Wheel() {
  const [isSpinning, setIsSpinning] = useState(false);
  const [result, setResult] = useState("");
  const [popUp, setPopUp] = useState(false);
  const [segments, setSegments] = useState([]); // State to store fetched segments

  useEffect(() => {
    const fetchResult = async () => {
      const response = await fetch(
        "https://advanced-frontend-development.andreaskadhede.dk/wp-json/wp/v2/boardgame?acf_format=standard&orderby=date&order=asc&per_page=50"
      );
      const boardgames = await response.json();

      const newSegments = boardgames.map((game) => ({
        name: game.acf?.name || game.title?.rendered || "Unknown",
        placement: game.acf?.placement || "No description available",
        cover: game.acf?.cover || null,
        id: game.id || "Unknown ID",
      }));

      setSegments(newSegments); // Set the fetched segments
    };
    fetchResult();
  }, []);

  const spinWheel = () => {
    if (isSpinning || segments.length === 0) return; // Prevent multiple spins and check if segments exist
    const extraRotation = 11.25;

    const randomSegment = Math.floor(Math.random() * segments.length);
    const rotation =
      360 * 3 + (360 / segments.length) * randomSegment + extraRotation;

    setIsSpinning(true);
    setResult("");

    const wheel = document.getElementById("wheel");
    wheel.style.transform = `rotate(${rotation}deg)`;

    setTimeout(() => {
      setIsSpinning(false);
      setResult(segments[randomSegment]);
      setPopUp(true); // Show popup with result
    }, 5000); // Match animation duration
  };

  return (
    <div className="container">
      <Image
        onClick={spinWheel}
        className="wheel_low"
        src="/img/wheel_legs_low.svg"
        height={400}
        width={400}
        alt="Lykkehjul"
      />
      <div className="wheelContainer">
        <div id="wheel" className="wheel">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 147.38 150.79">
            <circle className="cls-1" cx="73.69" cy="73.69" r="73.69" />
            <g>
              <path
                className="cls-2"
                d="m73.69,7.16v66.52L48.23,12.22c.18-.08.37-.16.55-.23.34-.14.69-.28,1.04-.41.38-.15.77-.29,1.15-.42.37-.14.75-.27,1.12-.4.45-.15.91-.3,1.35-.44.43-.14.88-.27,1.31-.4.51-.15,1.03-.3,1.54-.43.52-.14,1.04-.27,1.56-.4.51-.13,1.04-.25,1.56-.36.52-.11,1.05-.22,1.57-.32,1.04-.21,2.1-.38,3.15-.53.48-.07.97-.13,1.45-.19.15-.02.3-.04.45-.05.39-.05.8-.09,1.19-.13.09-.01.17-.02.26-.03.47-.04.94-.08,1.41-.11,1.59-.11,3.18-.17,4.78-.17Z"
              />
              <path
                className="cls-8"
                d="m26.65,26.65l47.04,47.04L12.23,48.23c.07-.19.15-.38.23-.56.14-.34.29-.68.44-1.03.16-.38.33-.75.51-1.11.16-.36.33-.72.51-1.08.21-.43.43-.86.64-1.27.21-.41.43-.81.64-1.21.26-.47.51-.94.78-1.4.27-.47.54-.93.82-1.39.27-.46.56-.91.85-1.36.29-.45.58-.9.88-1.34.58-.88,1.21-1.75,1.85-2.61.29-.39.59-.78.89-1.16.09-.12.19-.24.29-.36.24-.31.5-.63.75-.93.06-.07.11-.14.16-.21.31-.36.61-.72.92-1.08,1.05-1.2,2.13-2.37,3.26-3.5Z"
              />
              <path
                className="cls-9"
                d="m48.23,12.23l25.46,61.46L26.65,26.64c.14-.14.28-.29.42-.43.26-.26.53-.52.8-.78.3-.29.6-.56.9-.83.29-.27.58-.54.88-.8.36-.31.72-.63,1.08-.93.35-.3.71-.59,1.06-.87.42-.34.83-.67,1.26-.99.43-.33.85-.65,1.29-.97.42-.32.86-.63,1.3-.93.44-.3.88-.61,1.33-.9.88-.59,1.79-1.16,2.71-1.7.42-.25.84-.49,1.27-.73.13-.08.26-.15.4-.22.34-.2.7-.39,1.05-.58.08-.04.15-.08.23-.13.42-.22.84-.43,1.26-.64,1.43-.71,2.88-1.38,4.35-1.99Z"
              />
              <path
                className="cls-3"
                d="m73.69,73.69h66.52c0-9.02-1.8-17.61-5.06-25.45l-61.46,25.45Z"
              />
              <path
                className="cls-6"
                d="m73.69,7.16v66.52l25.46-61.46c-.18-.08-.37-.16-.55-.23-.34-.14-.69-.28-1.04-.41-.38-.15-.77-.29-1.15-.42-.37-.14-.75-.27-1.12-.4-.45-.15-.91-.3-1.35-.44-.43-.14-.88-.27-1.31-.4-.51-.15-1.03-.3-1.54-.43-.52-.14-1.04-.27-1.56-.4-.51-.13-1.04-.25-1.56-.36-.52-.11-1.05-.22-1.57-.32-1.04-.21-2.1-.38-3.15-.53-.48-.07-.97-.13-1.45-.19-.15-.02-.3-.04-.45-.05-.39-.05-.8-.09-1.19-.13-.09-.01-.17-.02-.26-.03-.47-.04-.94-.08-1.41-.11-1.59-.11-3.18-.17-4.78-.17Z"
              />
              <path
                className="cls-4"
                d="m120.73,26.65l-47.04,47.04,61.46-25.46c-.07-.19-.15-.38-.23-.56-.14-.34-.29-.68-.44-1.03-.16-.38-.33-.75-.51-1.11-.16-.36-.33-.72-.51-1.08-.21-.43-.43-.86-.64-1.27-.21-.41-.43-.81-.64-1.21-.26-.47-.51-.94-.78-1.4-.27-.47-.54-.93-.82-1.39-.27-.46-.56-.91-.85-1.36-.29-.45-.58-.9-.88-1.34-.58-.88-1.21-1.75-1.85-2.61-.29-.39-.59-.78-.89-1.16-.09-.12-.19-.24-.29-.36-.24-.31-.5-.63-.75-.93-.06-.07-.11-.14-.16-.21-.31-.36-.61-.72-.92-1.08-1.05-1.2-2.13-2.37-3.26-3.5Z"
              />
              <path
                className="cls-5"
                d="m99.15,12.23l-25.46,61.46,47.04-47.04c-.14-.14-.28-.29-.42-.43-.26-.26-.53-.52-.8-.78-.3-.29-.6-.56-.9-.83-.29-.27-.58-.54-.88-.8-.36-.31-.72-.63-1.08-.93-.35-.3-.71-.59-1.06-.87-.42-.34-.83-.67-1.26-.99-.43-.33-.85-.65-1.29-.97-.42-.32-.86-.63-1.3-.93-.44-.3-.88-.61-1.33-.9-.88-.59-1.79-1.16-2.71-1.7-.42-.25-.84-.49-1.27-.73-.13-.08-.26-.15-.4-.22-.34-.2-.7-.39-1.05-.58-.08-.04-.15-.08-.23-.13-.42-.22-.84-.43-1.26-.64-1.43-.71-2.88-1.38-4.35-1.99Z"
              />
              <path
                className="cls-6"
                d="m73.69,140.21v-66.52l-25.46,61.46c.18.08.37.16.55.23.34.14.69.28,1.04.41.38.15.77.29,1.15.42.37.14.75.27,1.12.4.45.15.91.3,1.35.44.43.14.88.27,1.31.4.51.15,1.03.3,1.54.43.52.14,1.04.27,1.56.4.51.13,1.04.25,1.56.36.52.11,1.05.22,1.57.32,1.04.21,2.1.38,3.15.53.48.07.97.13,1.45.19.15.02.3.04.45.05.39.05.8.09,1.19.13.09.01.17.02.26.03.47.04.94.08,1.41.11,1.59.11,3.18.17,4.78.17Z"
              />
              <path
                className="cls-7"
                d="m73.69,73.69h66.52c0,9.02-1.8,17.61-5.06,25.45l-61.46-25.45Z"
              />
              <path
                className="cls-5"
                d="m73.69,140.21v-66.52l25.46,61.46c-.18.08-.37.16-.55.23-.34.14-.69.28-1.04.41-.38.15-.77.29-1.15.42-.37.14-.75.27-1.12.4-.45.15-.91.3-1.35.44-.43.14-.88.27-1.31.4-.51.15-1.03.3-1.54.43-.52.14-1.04.27-1.56.4-.51.13-1.04.25-1.56.36-.52.11-1.05.22-1.57.32-1.04.21-2.1.38-3.15.53-.48.07-.97.13-1.45.19-.15.02-.3.04-.45.05-.39.05-.8.09-1.19.13-.09.01-.17.02-.26.03-.47.04-.94.08-1.41.11-1.59.11-3.18.17-4.78.17Z"
              />
              <path
                className="cls-8"
                d="m120.73,120.73l-47.04-47.04,61.46,25.46c-.07.19-.15.38-.23.56-.14.34-.29.68-.44,1.03-.16.38-.33.75-.51,1.11-.16.36-.33.72-.51,1.08-.21.43-.43.86-.64,1.27-.21.41-.43.81-.64,1.21-.26.47-.51.94-.78,1.4-.27.47-.54.93-.82,1.39-.27.46-.56.91-.85,1.36-.29.45-.58.9-.88,1.34-.58.88-1.21,1.75-1.85,2.61-.29.39-.59.78-.89,1.16-.09.12-.19.24-.29.36-.24.31-.5.63-.75.93-.06.07-.11.14-.16.21-.31.36-.61.72-.92,1.08-1.05,1.2-2.13,2.37-3.26,3.5Z"
              />
              <path
                className="cls-9"
                d="m99.15,135.15l-25.46-61.46,47.04,47.04c-.14.14-.28.29-.42.43-.26.26-.53.52-.8.78-.3.29-.6.56-.9.83-.29.27-.58.54-.88.8-.36.31-.72.63-1.08.93-.35.3-.71.59-1.06.87-.42.34-.83.67-1.26.99-.43.33-.85.65-1.29.97-.42.32-.86.63-1.3.93-.44.3-.88.61-1.33.9-.88.59-1.79,1.16-2.71,1.7-.42.25-.84.49-1.27.73-.13.08-.26.15-.4.22-.34.2-.7.39-1.05.58-.08.04-.15.08-.23.13-.42.22-.84.43-1.26.64-1.43.71-2.88,1.38-4.35,1.99Z"
              />
              <path
                className="cls-2"
                d="m73.69,140.21v-66.52l25.46,61.46c-.18.08-.37.16-.55.23-.34.14-.69.28-1.04.41-.38.15-.77.29-1.15.42-.37.14-.75.27-1.12.4-.45.15-.91.3-1.35.44-.43.14-.88.27-1.31.4-.51.15-1.03.3-1.54.43-.52.14-1.04.27-1.56.4-.51.13-1.04.25-1.56.36-.52.11-1.05.22-1.57.32-1.04.21-2.1.38-3.15.53-.48.07-.97.13-1.45.19-.15.02-.3.04-.45.05-.39.05-.8.09-1.19.13-.09.01-.17.02-.26.03-.47.04-.94.08-1.41.11-1.59.11-3.18.17-4.78.17Z"
              />
              <path
                className="cls-3"
                d="m73.69,73.69H7.16c0,9.02,1.8,17.61,5.06,25.45l61.46-25.45Z"
              />
              <path
                className="cls-6"
                d="m73.69,140.21v-66.52l-25.46,61.46c.18.08.37.16.55.23.34.14.69.28,1.04.41.38.15.77.29,1.15.42.37.14.75.27,1.12.4.45.15.91.3,1.35.44.43.14.88.27,1.31.4.51.15,1.03.3,1.54.43.52.14,1.04.27,1.56.4.51.13,1.04.25,1.56.36.52.11,1.05.22,1.57.32,1.04.21,2.1.38,3.15.53.48.07.97.13,1.45.19.15.02.3.04.45.05.39.05.8.09,1.19.13.09.01.17.02.26.03.47.04.94.08,1.41.11,1.59.11,3.18.17,4.78.17Z"
              />
              <path
                className="cls-4"
                d="m26.65,120.73l47.04-47.04-61.46,25.46c.07.19.15.38.23.56.14.34.29.68.44,1.03.16.38.33.75.51,1.11.16.36.33.72.51,1.08.21.43.43.86.64,1.27.21.41.43.81.64,1.21.26.47.51.94.78,1.4.27.47.54.93.82,1.39.27.46.56.91.85,1.36.29.45.58.9.88,1.34.58.88,1.21,1.75,1.85,2.61.29.39.59.78.89,1.16.09.12.19.24.29.36.24.31.5.63.75.93.06.07.11.14.16.21.31.36.61.72.92,1.08,1.05,1.2,2.13,2.37,3.26,3.5Z"
              />
              <path
                className="cls-5"
                d="m48.23,135.15l25.46-61.46-47.04,47.04c.14.14.28.29.42.43.26.26.53.52.8.78.3.29.6.56.9.83.29.27.58.54.88.8.36.31.72.63,1.08.93.35.3.71.59,1.06.87.42.34.83.67,1.26.99.43.33.85.65,1.29.97.42.32.86.63,1.3.93.44.3.88.61,1.33.9.88.59,1.79,1.16,2.71,1.7.42.25.84.49,1.27.73.13.08.26.15.4.22.34.2.7.39,1.05.58.08.04.15.08.23.13.42.22.84.43,1.26.64,1.43.71,2.88,1.38,4.35,1.99Z"
              />
              <path
                className="cls-7"
                d="m73.69,73.69H7.16c0-9.02,1.8-17.61,5.06-25.45l61.46,25.45Z"
              />
            </g>
            <circle className="cls-1" cx="73.69" cy="73.69" r="12.37" />
          </svg>
        </div>
        <div className="pointer" />
      </div>
      <button
        id="pop_1"
        onClick={spinWheel}
        disabled={isSpinning}
        className="spinButton"
      >
        {isSpinning ? "Spinning..." : "Tryk for at spinne!"}
      </button>

      <p onClick={spinWheel} id="pop_1" className="box_header">
        <br />
      </p>

      {popUp && (
        <div className="card">
          <div className="card_top">
            <div className="width2rem">
              <Image
                src="/icons/heart.svg"
                alt="heart icon"
                width={400}
                height={400}
                className="card_icon"
              />
            </div>
            <h2>TILLYKKE</h2>
            <div className="width2rem">
              <button onClick={() => setPopUp(false)}>Close</button>
            </div>
          </div>
          <div className="card_middle">
            <p className="fontsize16">Vi foreslår dig at spille </p>
            <Image
              src={result.cover}
              height={400}
              width={400}
              alt={result.name}
            />
            <p className="fontsize16">Find spillet på {result.placement}</p>
            <Link href={`/boardgames/${result.id}`}>Læs mere om spillet</Link>
          </div>
          <div className="card_bottom">
            <div className="width2rem"></div>
            <h2>TILLYKKE</h2>
            <div className="width2rem">
              <Image
                src="/icons/heart.svg"
                alt="heart icon"
                width={400}
                height={400}
                className="card_icon"
              />
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
